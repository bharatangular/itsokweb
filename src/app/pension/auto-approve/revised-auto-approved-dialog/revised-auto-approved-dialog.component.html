<div class="container" >
    <div class="row" style="height: 75vh; overflow-y: auto;">

      <div class="row mb-5">  
        <div class="col-lg-11">
          <h2 class="my-3">Commutation e-Pension</h2>
        </div>
        <div class="col-lg-1">
          <button class="btn btn-outline-cancel me-2" mat-stroked-button color="primary" type="button" mat-dialog-close>X</button>
        </div>
      </div>
  
      <div class="row">
        <div class="col-xs-6 col-sm-6 col-md-4 col-lg-4 col-xl-4 col-xxl-4 ">
            <div class="avatar-upload">
              <span>Employee Photograph</span>
              <!-- <div class="avatar-edit">
                <input type='file' id="imageUpload" accept=".png, .jpg, .jpeg" #fileInput
                  (change)="uploadFile($event)" />
              </div> -->
              <div class="avatar-preview">
                <!-- <div id="imagePreview" [style.backgroundImage]="'url('+ imageUrl +')'"
                  > <i class="fa fa-edit"></i>
                </div> -->
                <img [src]="imageUrl?imageUrl:'assets/images/male-avatar.jpg'" class="shadow" />
              </div>
              <!-- <button class="editbutton" (click)="fileInput.click()"><mat-icon>edit</mat-icon></button> -->
            </div>
          </div>
        <div class="col-xs-6 col-sm-6 col-md-4 col-lg-4 col-xl-4 col-xxl-4 ">
            <div class="avatar-upload">

              <span>Joint Photograph</span>
            
              <div class="avatar-preview">
                <!-- <div id="imagePreview" [style.backgroundImage]="'url('+ jointImageUrl +')'"> <i
                    class="fa fa-edit"></i>
                </div> -->
                <img [src]="jointUrl?jointUrl:'assets/images/male-avatar.jpg'" class="shadow" />
              </div>
              <!-- <button class="editbutton" (click)="fileInput.click()"><mat-icon>edit</mat-icon></button> -->
            </div>
          </div>
       
        <hr class="my-3">
        <div class="col-xs-6 col-sm-6 col-md-4 col-lg-4 col-xl-4 col-xxl-4 ">
          <mat-label class="d-block">Employee Name: </mat-label>
          <strong style="letter-spacing: 2px;">{{Personaldetail?Personaldetail.nameEn:"N/A"}}</strong>
        </div>
        <div class="col-xs-6 col-sm-6 col-md-4 col-lg-4 col-xl-4 col-xxl-4 ">
          <mat-label class="d-block">Employee Code: </mat-label>
          <strong  style="letter-spacing: 2px;">{{Personaldetail?Personaldetail.employeeCode:"N/A"}}</strong>
        </div>
        <div class="col-xs-6 col-sm-6 col-md-4 col-lg-4 col-xl-4 col-xxl-4 ">
          <mat-label class="d-block">PPO No: </mat-label>
          <strong  style="letter-spacing: 2px;">{{data.message.item?.ppoNo}}</strong>
  
        </div>
       
      
        <hr class="my-3">
  
        <div class="col-xs-6 col-sm-6 col-md-4 col-lg-4 col-xl-4 col-xxl-4 ">
          <mat-label class="d-block">Pension Amount: </mat-label>
          <strong  style="letter-spacing: 2px;">{{Pension_Commutation?.pensionAmount}}</strong>
  
        </div>
        <div class="col-xs-6 col-sm-6 col-md-4 col-lg-4 col-xl-4 col-xxl-4 ">
          <mat-label class="d-block">Commuted Pension: </mat-label>
          <strong  style="letter-spacing: 2px;">{{Pension_Commutation?.cpoDeduction}}</strong>
        </div>
        <div class="col-xs-6 col-sm-6 col-md-4 col-lg-4 col-xl-4 col-xxl-4 ">
          <mat-label class="d-block">Reduced Pension Amount: </mat-label>
          <strong  style="letter-spacing: 2px;">{{Pension_Commutation?.netpensionAmount}}</strong>
        </div>
       
        <!-- <div class="col-xs-6 col-sm-6 col-md-4 col-lg-4 col-xl-4 col-xxl-4 ">
          <mat-label>Family Pension: </mat-label>
          <strong>{{Pension_Commutation?.familyPension}}</strong>
        </div> -->
        <hr class="my-3">
  
        <!-- <div class="col-xs-6 col-sm-6 col-md-4 col-lg-4 col-xl-4 col-xxl-4 ">
          <mat-label>Enhance Pension: </mat-label>
          <strong>{{Pension_Commutation?.enhancedPension}}</strong>
        </div> -->
  
        <!-- <div class="col-xs-6 col-sm-6 col-md-4 col-lg-4 col-xl-4 col-xxl-4 ">
          <mat-label>DR Rate: </mat-label>
          <strong>{{Pension_Commutation?.daRate}} %</strong>
        </div> -->
  
        <!-- <div class="col-xs-6 col-sm-6 col-md-4 col-lg-4 col-xl-4 col-xxl-4 ">
          <mat-label>Enhance Date: </mat-label>
          <strong>{{Pension_Commutation?Pension_Commutation.enhancedPensionDate:" "}}</strong>
        </div> -->
        <!-- <hr class="my-3"> -->
  
  
        <!-- <div class="col-xs-6 col-sm-6 col-md-4 col-lg-4 col-xl-4 col-xxl-4 ">
          <mat-label>Pension Commencement Date :</mat-label>
          <strong>{{Pension_Commutation?Pension_Commutation.pensionStartDate:" "}}</strong>
        </div> -->
        <!-- <div class="col-xs-6 col-sm-6 col-md-4 col-lg-4 col-xl-4 col-xxl-4 ">
          <mat-label>DCRG (Gratuity): </mat-label>
          <strong>{{Pension_Commutation?.retirGratuity}}</strong>
        </div> -->
  
  
        <!-- <div class="col-xs-6 col-sm-6 col-md-4 col-lg-4 col-xl-4 col-xxl-4 ">
          <mat-label>Payable DCRG: </mat-label>
          <strong>{{Pension_Commutation?.netPay}}</strong>
  
        </div> -->
        <!-- <hr class="my-3"> -->
        <!-- <div class="col-xs-6 col-sm-6 col-md-4 col-lg-4 col-xl-4 col-xxl-4 ">
                  <mat-label>Service Gratuity </mat-label>
                  <strong>{{Pension_Commutation?.serviceGratuity}}</strong>              
              </div> -->
              <!-- <div class="col-xs-6 col-sm-6 col-md-4 col-lg-4 col-xl-4 col-xxl-4 ">
          <mat-label>Date of Commencement: </mat-label>
          <strong>{{Pension_Commutation?Pension_Commutation.enhancedPensionDate:" "}}</strong>
        </div> -->
              <div class="col-xs-6 col-sm-6 col-md-4 col-lg-4 col-xl-4 col-xxl-4 ">
                <mat-label class="d-block">Budget Head For Commutation: </mat-label><br>
                <strong style="letter-spacing: 2px;">{{getBudHead("Commutation")}}</strong>
                <!-- <strong>{{Calculations_Pay_Details?Calculations_Pay_Details.gratuityBudgetHead:""}}</strong> -->
              </div>
        <!-- <div class="col-xs-6 col-sm-6 col-md-4 col-lg-4 col-xl-4 col-xxl-4 ">
          <mat-label>Budget Head For Gratuity: </mat-label>
          <strong>{{getBudHead("Gratuity")}}</strong>
          <strong>{{Calculations_Pay_Details?Calculations_Pay_Details.gratuityBudgetHead:""}}</strong>
        </div> -->
  
        <div class="col-xs-6 col-sm-6 col-md-4 col-lg-4 col-xl-4 col-xxl-4">
          <mat-label class="d-block">Applicable Emolument: </mat-label>
          <strong style="letter-spacing: 2px;">{{Pension_Commutation?.lastEmolument}}</strong>
        </div>
        <hr class="my-3">
        <div class="col-xs-6 col-sm-6 col-md-4 col-lg-4 col-xl-4 col-xxl-12">
          <mat-label class="d-block">Office Address: </mat-label><br>
          <strong style="letter-spacing: 2px;">{{EMPAddress?.officeAddresses[0]?.officeNameEn+"("+EMPAddress?.officeAddresses[0]?.officeId+")"}}</strong>
        </div>
        <hr class="my-3">
        <div class="row">
  
          <!-- <div class="col-xs-6 col-sm-6 col-md-4 col-lg-4 col-xl-4 col-xxl-4">
              <mat-label>Commutation Effective Date:</mat-label>
              <strong>{{Pension_Commutation2?.commutationEffectiveDate  }}</strong>
              
           
          </div> -->
  
  
          
          <div class="col-xs-6 col-sm-6 col-md-4 col-lg-4 col-xl-4 col-xxl-4">
              <mat-label class="d-block">Commutation Amount: </mat-label>
              <strong style="letter-spacing: 2px;">{{Pension_Commutation2?.commutationAmount}}</strong>
          </div>
          <div class="col-xs-6 col-sm-6 col-md-4 col-lg-4 col-xl-4 col-xxl-4" >
            <mat-label class="d-block">Net Payable Commutation Amount: </mat-label>
            <strong style="letter-spacing: 2px;">{{Pension_Commutation2?.netPayCommutationAmount?Pension_Commutation2?.netPayCommutationAmount:Pension_Commutation2?.commutationAmount}}</strong>
        </div>
          
          <div class="col-xs-6 col-sm-6 col-md-4 col-lg-4 col-xl-4 col-xxl-4">
              <mat-label class="d-block">Commutation Factor: </mat-label>
              <strong style="letter-spacing: 2px;">{{Pension_Commutation2?.commutedFactor}}</strong>
              
          </div>
          
          <div class="col-xs-6 col-sm-6 col-md-4 col-lg-4 col-xl-4 col-xxl-4">
            <div>
              <mat-label class="d-block"> Commutation Percentage: </mat-label>
              <strong style="letter-spacing: 2px;">{{Pension_Commutation2?.commutationValue}}</strong>
            </div>
          </div>

          <!-- <div class="col-xs-6 col-sm-6 col-md-4 col-lg-4 col-xl-4 col-xxl-4">
            <div>
              <mat-label>Qualifying Service </mat-label>
              <strong>{{Pension_Commutation2?.totalQualifyingService}}</strong>
            </div>
           
            
           
            
          </div> -->
          <div class="col-xs-6 col-sm-6 col-md-4 col-lg-4 col-xl-4 col-xxl-4">
           
          </div>
          <hr class="my-3">
          <div class="col-xs-6 col-sm-6 col-md-4 col-lg-4 col-xl-4 col-xxl-4 ">
            <mat-label class="my-3">Select DE/Judiciary Proceedings </mat-label>
            <mat-form-field class="w-100">
              <mat-select matNativeControl required [(ngModel)]="serviceRecordDatanew.deStatus"
                [ngModelOptions]="{standalone: true}" (selectionChange)="deChange()" >
                <mat-option value="2" > </mat-option>
                <mat-option value="1">Yes</mat-option>
                <mat-option value="0">No</mat-option>
    
              </mat-select>
            </mat-form-field>
          </div>
        <div class="col-xs-6 col-sm-6 col-md-4 col-lg-4 col-xl-4 col-xxl-4 " *ngIf="serviceRecordDatanew.deStatus=='1' ">
            <mat-label>Select DE/Judiciary Proceedings Type</mat-label>
            <mat-form-field class="w-100">
              <mat-select matNativeControl required [ngModelOptions]="{standalone: true}"
                [(ngModel)]="serviceRecordDatanew.deType" (selectionChange)="deTypeChange()">
                <mat-option *ngFor="let obj of detypelist" [value]="obj.deTypeId">{{obj.deTypeName}}</mat-option>
              </mat-select>
            </mat-form-field>
          </div>
        </div>
      </div>
      <div class="col-xs-4 col-sm-4 col-md-4 col-lg-4 col-xl-4 col-xxl-4 "  *ngIf="serviceRecordDatanew.deStatus=='1' ">
        <mat-label>Remark</mat-label>
        <mat-form-field class="example-full-width" class="w-100">
          <textarea rows="1" matInput [ngModelOptions]="{standalone: true}"
          [(ngModel)]="remark"></textarea>
        </mat-form-field>

      </div>

      <div class="col-lg-4"  *ngIf="serviceRecordDatanew.deStatus=='1' && userDetails.roleid!='6'">
        <mat-label>DE Document <span class="material-icons text-danger d-inline">*</span></mat-label>      
        <div class="file-uploder-container d-flex flex-column mt-2">
          <label for="inputGroupFile" class="upload-lable-text btn py-1">Drag & drop or <span
              class="file-browse"> browse </span></label>
          <div class="input-group custom-file-button">
            <input type="file" class="form-control file-upload-input hidden" id="inputGroupFile" hidden (change)="selectFile($event)">
          </div>
         
        </div>
      </div>
        <div class="col-lg-2 my-2">
         
            <mat-spinner [diameter]="30" *ngIf="isLoading" ></mat-spinner>
          </div>
<hr>
<div class="group-gap" >

  <div class="row" *ngIf=" serviceRecordDatanew.deStatus!='1'">
    <h2>Recovery Details:</h2>
    <form [formGroup]="recoveryFormNew" *ngIf="userDetails.roleid==3">
      <div class="row">
        <div class="col-lg-11">
          <div class="row">
            <div class="col-lg-4">
              <mat-form-field class="w-100">
                <mat-label>Recovery Type</mat-label>
                <input matInput placeholder="Recovery Type" formControlName="recoveryType">

              </mat-form-field>
            </div>
            <div class="col-lg-4">
              <mat-form-field class="w-100">
                <mat-label>Recovery Amount</mat-label>
                <input matInput type="number" placeholder="Recovery Amount"
                  formControlName="recoveryAmount">
              </mat-form-field>
            </div>
            <div class="col-lg-4">
              <mat-form-field class="w-100">
                <mat-label>Recovery Head</mat-label>
                <input matInput placeholder="Recovery Head" (keypress)="omit_special_char($event)" (blur)="checkHeadLength($event)" formControlName="recoveryHead">
              </mat-form-field>
              <span style="color:#afadad">(Ex.Head:2230-01-102-02-01)</span>
            </div>
          </div>
        </div>
        <div class="col-lg-1">
          <div class="mt-2">
            <button type="submit" class="btn btn-sm btn-success add-items custome_btn"
              (click)="addRecovery()">Add</button>
          </div>
        </div>



      </div>

    </form>


    <div class="">
      <ng-container *ngFor="let item of recoveryArray; let i = index">
        <div class="" >
          <div class="row">
            <div class="col-lg-11">
              <div class="row">
                <div class="col-lg-4">
                    <mat-label>Recovery Type</mat-label><br>
                    <mat-label>{{item.recoveryType}}</mat-label>
                </div>
                <div class="col-lg-4">
                    <mat-label>Recovery Amount</mat-label><br>
                    <mat-label>{{item.recoveryAmount}}</mat-label>
                </div>
                <div class="col-lg-4">
                    <mat-label>Recovery Head</mat-label><br>
                    <mat-label>{{item.recoveryHead}}</mat-label>
                </div>
              </div>
            </div>
            <div class="col-lg-1">
              <mat-icon color="warn" class="m-2" (click)="onRemoveSpecialRequest(i)" *ngIf="userDetails.roleid==3">delete
              </mat-icon>
            </div>
          </div>
        </div>
      </ng-container>
    </div>
    <hr class="m-2">
  </div>
 
</div>
<span style="color: rgb(248, 9, 9);font-size: 16px;"  *ngIf="userDetails.roleid==6">*Single/Joint photo is approved by HO(Approver) on Dated:{{data.message.item?.hoApproveDate}}</span>
<div class="modal-sm verify-otp-modal" *ngIf="showOtpdialog">
<div class="" >
  <div class="row">
   
  
  </div>
  
  
    <form [formGroup]="otpForm" class="row">
      <div class="col-lg-4">
        <p class="heading-1 bodytext-color m-0">Verify OTP</p>
        <p class="mobile-text">Sent to <span>{{ maskedPhoneNo }}</span></p>
      </div>

      <div class="col-lg-4">
        <p class="mobile-text f-12 m-0">Enter your OTP<span class="mendetory-class">*</span></p>
        <div class="input-otp-group">
          <mat-form-field class="otp-width me-2" appearance="outline">
            <input numberOnly matInput formControlName="otpInput1" #otpInput1 maxlength="1"
              (keyup)="onOtpKeyUp($event, otpInput2, null, 1)">
          </mat-form-field>
          <mat-form-field class="otp-width me-2" appearance="outline">
            <input numberOnly matInput formControlName="otpInput2" #otpInput2 maxlength="1"
              (keyup)="onOtpKeyUp($event, otpInput3, otpInput1, 1)">
          </mat-form-field>
          <mat-form-field class="otp-width me-2" appearance="outline">
            <input numberOnly matInput formControlName="otpInput3" #otpInput3 maxlength="1"
              (keyup)="onOtpKeyUp($event, otpInput4, otpInput2, 1)">
          </mat-form-field>
          <mat-form-field class="otp-width me-2" appearance="outline">
            <input numberOnly matInput formControlName="otpInput4" #otpInput4 maxlength="1"
              (keyup)="onOtpKeyUp($event, otpInput5, otpInput3, 1)">
          </mat-form-field>
          <mat-form-field class="otp-width me-2" appearance="outline">
            <input numberOnly matInput formControlName="otpInput5" #otpInput5 maxlength="1"
              (keyup)="onOtpKeyUp($event, otpInput6, otpInput4, 1)">
          </mat-form-field>
          <mat-form-field class="otp-width me-2" appearance="outline">
            <input numberOnly matInput formControlName="otpInput6" #otpInput6 maxlength="1"
              (keyup)="onOtpKeyUp($event, null, otpInput5, 1)">
          </mat-form-field>
        </div>
        
      </div>
      <div class="col-lg-4">
        <!-- <button class="proceed-otp" [disabled]="otpForm.invalid" mat-raised-button color="primary"
          type="submit">Proceed</button> -->
        <button class="proceed-otp mt-4" [disabled]="otpForm.invalid" mat-raised-button color="primary" type="button"
        (click)="checkOtp('Y')">Proceed</button>
        
      </div>
    </form>
  
</div>
</div>
      <div class="my-2">
          <mat-checkbox class="example-margin" [(ngModel)]="isverify" *ngIf="serviceRecordDatanew.deStatus=='0' && !showOtpdialog && userDetails.roleid!=6">I hereby verify above employee details and calculation of pension data.</mat-checkbox>
        
        </div>
        <div class="my-2 text-end">
          <button mat-raised-button color="primary" (click)="UpdateFlag(4)" *ngIf="userDetails.roleid==6 && !showOtpdialog" class="mx-2" >Revert Request</button>
      
          <button mat-raised-button color="primary" (click)="makerequestINI()" [disabled]="!isverify" *ngIf=" serviceRecordDatanew.deStatus=='0' && userDetails.roleid==6 && !showOtpdialog ">Verify & Approve</button>
      </div>
      
      <div class="my-2 text-end">
        <button mat-raised-button color="primary" (click)="uploadFile(2)" *ngIf="serviceRecordDatanew.deStatus=='1' && userDetails.roleid==3" >Reject Request</button>
    </div>
    
    <div class="my-2 text-end">
      <button mat-raised-button color="primary" (click)="UpdateFlag(1)" [disabled]="!isverify" *ngIf="userDetails.roleid==3 && serviceRecordDatanew.deStatus=='0'" >Forward</button>
  </div>
     
     
     
     
    </div>
  </div>
  